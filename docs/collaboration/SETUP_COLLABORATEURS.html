<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotaireAI - Setup Collaborateurs</title>
    <style>
        :root {
            --primary: #3ECF8E;
            --primary-dark: #2da872;
            --bg: #1a1a2e;
            --bg-light: #232340;
            --text: #f0f0f0;
            --text-muted: #a0a0a0;
            --border: #3a3a5a;
            --code-bg: #0d0d1a;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary), #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        h2 {
            color: var(--primary);
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
        }

        h3 {
            color: var(--text);
            margin: 1.5rem 0 0.75rem;
        }

        .step {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid var(--primary);
        }

        .step-number {
            display: inline-block;
            background: var(--primary);
            color: var(--bg);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            font-weight: bold;
            margin-right: 0.75rem;
        }

        .step-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        pre {
            background: var(--code-bg);
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
            border: 1px solid var(--border);
        }

        code {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
        }

        .inline-code {
            background: var(--code-bg);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .warning-title {
            color: var(--warning);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .copy-btn {
            background: var(--primary);
            color: var(--bg);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 0.5rem;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: var(--primary-dark);
        }

        .copy-btn:active {
            transform: scale(0.98);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-light);
            color: var(--primary);
        }

        .prompt-box {
            background: linear-gradient(135deg, var(--bg-light), #1e3a5f);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .prompt-box h3 {
            color: var(--primary);
            margin-top: 0;
        }

        .prompt-content {
            background: var(--code-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
            white-space: pre-wrap;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            line-height: 1.8;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        ul, ol {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        li {
            margin: 0.5rem 0;
        }

        .success {
            color: var(--primary);
        }

        .prereq-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .prereq-item {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .prereq-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>NotaireAI - Setup Collaborateurs</h1>
            <p class="subtitle">Guide de configuration Supabase + Claude Code MCP</p>
        </header>

        <section>
            <h2>Pr√©requis</h2>
            <div class="prereq-grid">
                <div class="prereq-item">
                    <div class="prereq-icon">üíª</div>
                    <strong>VS Code</strong>
                    <p class="text-muted">Avec extension Claude Code</p>
                </div>
                <div class="prereq-item">
                    <div class="prereq-icon">üì¶</div>
                    <strong>Node.js</strong>
                    <p class="text-muted">Pour npx (MCP)</p>
                </div>
                <div class="prereq-item">
                    <div class="prereq-icon">üêç</div>
                    <strong>Python 3.10+</strong>
                    <p class="text-muted">Pas 3.14 !</p>
                </div>
                <div class="prereq-item">
                    <div class="prereq-icon">üìß</div>
                    <strong>Invitation Supabase</strong>
                    <p class="text-muted">De Tom (email re√ßu)</p>
                </div>
            </div>
        </section>

        <section>
            <h2>Configuration en 5 √©tapes</h2>

            <div class="step">
                <div class="step-title">
                    <span class="step-number">1</span>
                    Accepter l'invitation Supabase
                </div>
                <ol>
                    <li>Ouvrez l'email d'invitation Supabase</li>
                    <li>Cliquez sur <strong>"Accept Invitation"</strong></li>
                    <li>Cr√©ez votre compte ou connectez-vous</li>
                    <li>Vous aurez acc√®s au projet <code class="inline-code">wcklvjckzktijtgakdrk</code></li>
                </ol>
            </div>

            <div class="step">
                <div class="step-title">
                    <span class="step-number">2</span>
                    Cr√©er votre Personal Access Token
                </div>
                <ol>
                    <li>Allez sur <a href="https://supabase.com/dashboard/account/tokens" target="_blank">supabase.com/dashboard/account/tokens</a></li>
                    <li>Cliquez sur <strong>"Generate new token"</strong></li>
                    <li>Nom : <code class="inline-code">Claude Code - [Votre Pr√©nom]</code></li>
                    <li><strong>Copiez et sauvegardez le token</strong> (commence par <code class="inline-code">sbp_</code>)</li>
                </ol>
                <div class="warning">
                    <div class="warning-title">‚ö†Ô∏è Important</div>
                    Le token ne sera affich√© qu'une seule fois. Sauvegardez-le dans un endroit s√ªr !
                </div>
            </div>

            <div class="step">
                <div class="step-title">
                    <span class="step-number">3</span>
                    R√©cup√©rer les derni√®res mises √† jour
                </div>

                <div class="warning">
                    <div class="warning-title">‚ö†Ô∏è Ne pas perdre votre travail !</div>
                    <strong>Si vous avez du travail en cours</strong>, utilisez le workflow normal :
                    <ol>
                        <li>Double-cliquez sur <code class="inline-code">end_day.bat</code> (sauvegarde votre travail)</li>
                        <li>Double-cliquez sur <code class="inline-code">start_day.bat</code> (r√©cup√®re les mises √† jour)</li>
                    </ol>
                </div>

                <p><strong>Premi√®re fois seulement</strong> (pas de travail en cours) :</p>
                <pre><code># Dans le dossier du projet
git pull origin master</code></pre>

                <p>Puis copiez le template MCP :</p>
                <pre><code>copy .mcp.json.template .mcp.json</code></pre>

                <p>√âditez <code class="inline-code">.mcp.json</code> et collez votre token (√©tape 2) :</p>
                <pre><code>{
  "mcpServers": {
    "supabase": {
      "command": "npx",
      "args": [
        "-y",
        "@supabase/mcp-server-supabase@latest",
        "--project-ref=wcklvjckzktijtgakdrk"
      ],
      "env": {
        "SUPABASE_ACCESS_TOKEN": "sbp_VOTRE_TOKEN_ICI"
      }
    }
  }
}</code></pre>
            </div>

            <div class="step">
                <div class="step-title">
                    <span class="step-number">4</span>
                    Configurer le fichier .env
                </div>
                <pre><code># Copier le template
copy .env.template .env   # Windows
cp .env.template .env     # Mac/Linux</code></pre>

                <p>R√©cup√©rez les cl√©s API depuis le <a href="https://supabase.com/dashboard/project/wcklvjckzktijtgakdrk/settings/api" target="_blank">Dashboard Supabase > Settings > API</a></p>

                <p><strong>OU utilisez le prompt Claude Code ci-dessous</strong> (plus simple !)</p>
            </div>

            <div class="step">
                <div class="step-title">
                    <span class="step-number">5</span>
                    Red√©marrer VS Code et tester
                </div>
                <ol>
                    <li>Fermez compl√®tement VS Code</li>
                    <li>Rouvrez-le dans le dossier du projet</li>
                    <li>Ouvrez Claude Code et demandez : <code class="inline-code">"Liste les tables Supabase"</code></li>
                </ol>
                <p class="success">‚úÖ Si vous voyez les tables (etudes, clients, dossiers...), c'est configur√© !</p>
            </div>
        </section>

        <section>
            <h2>Prompt Claude Code - Setup Automatique</h2>
            <p>Copiez ce prompt dans Claude Code pour configurer automatiquement votre <code class="inline-code">.env</code> :</p>

            <div class="prompt-box">
                <h3>üìã Prompt √† copier</h3>
                <div class="prompt-content" id="prompt-content">Configure mon fichier .env pour le projet NotaireAI.

Va chercher les API keys sur le Dashboard Supabase (Settings > API) du projet wcklvjckzktijtgakdrk et configure :

1. SUPABASE_URL (d√©j√† connu : https://wcklvjckzktijtgakdrk.supabase.co)
2. SUPABASE_KEY = la cl√© "anon public" (Legacy JWT)
3. SUPABASE_SERVICE_KEY = la cl√© "service_role" (Legacy JWT)

Pour ENCRYPTION_MASTER_KEY, g√©n√®re une nouvelle cl√© avec :
python execution/encryption_service.py generate-key

Puis mets √† jour mon .env avec toutes ces valeurs.</div>
                <button class="copy-btn" onclick="copyPrompt()">üìã Copier le prompt</button>
            </div>
        </section>

        <section>
            <h2>Workflow Quotidien</h2>
            <p>Une fois configur√©, voici votre routine quotidienne :</p>

            <div class="step" style="border-left-color: #60a5fa;">
                <div class="step-title">
                    <span class="step-number" style="background: #60a5fa;">‚òÄÔ∏è</span>
                    Le matin : start_day.bat
                </div>
                <p>Double-cliquez sur <code class="inline-code">start_day.bat</code></p>
                <ul>
                    <li>Fusionne automatiquement les PRs des autres</li>
                    <li>Lance l'auto-sync en arri√®re-plan</li>
                    <li>Vos changements sont sauvegard√©s automatiquement toutes les 30 min</li>
                </ul>
            </div>

            <div class="step" style="border-left-color: #f59e0b;">
                <div class="step-title">
                    <span class="step-number" style="background: #f59e0b;">üåô</span>
                    Le soir : end_day.bat
                </div>
                <p>Double-cliquez sur <code class="inline-code">end_day.bat</code></p>
                <ul>
                    <li>Commit et push de tout votre travail</li>
                    <li>Cr√©e automatiquement une Pull Request</li>
                    <li>Rien √† faire de plus !</li>
                </ul>
            </div>

            <div class="warning">
                <div class="warning-title">üí° R√®gle d'or</div>
                <strong>Ne jamais faire <code class="inline-code">git pull</code> directement</strong> si vous avez du travail en cours.<br>
                Utilisez toujours <code class="inline-code">end_day.bat</code> puis <code class="inline-code">start_day.bat</code> pour √©viter les conflits.
            </div>
        </section>

        <section>
            <h2>Informations du Projet</h2>
            <table>
                <tr>
                    <th>Param√®tre</th>
                    <th>Valeur</th>
                </tr>
                <tr>
                    <td>Project Ref</td>
                    <td><code class="inline-code">wcklvjckzktijtgakdrk</code></td>
                </tr>
                <tr>
                    <td>Region</td>
                    <td>Paris (eu-west-3) - RGPD compliant</td>
                </tr>
                <tr>
                    <td>Dashboard</td>
                    <td><a href="https://supabase.com/dashboard/project/wcklvjckzktijtgakdrk" target="_blank">Ouvrir le Dashboard</a></td>
                </tr>
            </table>

            <h3>Tables disponibles</h3>
            <table>
                <tr>
                    <th>Table</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code class="inline-code">etudes</code></td>
                    <td>√âtudes notariales (multi-tenant)</td>
                </tr>
                <tr>
                    <td><code class="inline-code">clients</code></td>
                    <td>Clients avec PII chiffr√©</td>
                </tr>
                <tr>
                    <td><code class="inline-code">dossiers</code></td>
                    <td>Dossiers/actes notariaux</td>
                </tr>
                <tr>
                    <td><code class="inline-code">audit_logs</code></td>
                    <td>Logs d'audit RGPD (3 ans)</td>
                </tr>
                <tr>
                    <td><code class="inline-code">rgpd_requests</code></td>
                    <td>Demandes de droits RGPD</td>
                </tr>
            </table>
        </section>

        <section>
            <h2>Commandes utiles dans Claude Code</h2>
            <pre><code># Lister les tables
"Liste les tables Supabase"

# Voir la structure d'une table
"Montre-moi la structure de la table clients"

# Ex√©cuter une requ√™te SQL
"Ex√©cute : SELECT * FROM etudes LIMIT 5"

# Tester la connexion Python
python execution/supabase_client.py</code></pre>
        </section>

        <section>
            <h2>Aide & D√©pannage</h2>
            <div class="warning">
                <div class="warning-title">üîß Probl√®mes courants</div>
                <ul>
                    <li><strong>MCP ne se connecte pas</strong> : V√©rifiez que le token dans <code class="inline-code">.mcp.json</code> est correct et red√©marrez VS Code</li>
                    <li><strong>Python "Invalid API key"</strong> : Utilisez les cl√©s <strong>Legacy JWT</strong> (pas les nouvelles publishable keys)</li>
                    <li><strong>Erreur httpcore</strong> : N'utilisez pas Python 3.14, pr√©f√©rez 3.10-3.12</li>
                    <li><strong>Encodage UTF-8 Windows</strong> : Les scripts g√®rent √ßa automatiquement</li>
                </ul>
            </div>

            <p>Si probl√®me persistant, contactez Tom !</p>
        </section>

        <footer>
            <p>NotaireAI &copy; 2026 - Configuration Supabase v1.0</p>
            <p>G√©n√©r√© le <span id="date"></span></p>
        </footer>
    </div>

    <script>
        function copyPrompt() {
            const prompt = document.getElementById('prompt-content').innerText;
            navigator.clipboard.writeText(prompt).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = '‚úÖ Copi√© !';
                setTimeout(() => {
                    btn.textContent = 'üìã Copier le prompt';
                }, 2000);
            });
        }

        document.getElementById('date').textContent = new Date().toLocaleDateString('fr-FR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    </script>
</body>
</html>
