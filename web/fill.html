<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotaireAI - Formulaire Acheteur</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Styles additionnels pour le formulaire sécurisé */
        .security-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .security-badge svg {
            width: 16px;
            height: 16px;
        }

        .info-banner {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .info-banner h3 {
            color: #0369a1;
            margin: 0 0 8px 0;
            font-size: 1rem;
        }

        .info-banner p {
            color: #0c4a6e;
            margin: 0;
            font-size: 0.9rem;
        }

        .error-state {
            text-align: center;
            padding: 60px 20px;
        }

        .error-state h2 {
            color: #dc2626;
            margin-bottom: 16px;
        }

        .error-state p {
            color: #6b7280;
            max-width: 400px;
            margin: 0 auto;
        }

        .loading-state {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-state .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e5e7eb;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .success-state {
            text-align: center;
            padding: 60px 20px;
        }

        .success-state .checkmark {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
        }

        .success-state .checkmark svg {
            width: 40px;
            height: 40px;
            color: white;
        }

        .success-state h2 {
            color: #059669;
            margin-bottom: 16px;
        }

        .dossier-info {
            background: #faf5ff;
            border: 1px solid #c084fc;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 24px;
            font-size: 0.9rem;
            color: #7c3aed;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>NotaireAI</h1>
            <p class="subtitle">Formulaire de collecte sécurisé</p>
        </header>

        <!-- État: Chargement -->
        <div id="loadingState" class="loading-state">
            <div class="spinner"></div>
            <p>Chargement du formulaire...</p>
        </div>

        <!-- État: Erreur (lien invalide/expiré) -->
        <div id="errorState" class="error-state hidden">
            <h2>Lien invalide ou expiré</h2>
            <p id="errorMessage">Ce lien de formulaire n'est plus valide. Veuillez contacter votre notaire pour obtenir un nouveau lien.</p>
        </div>

        <!-- État: Formulaire -->
        <div id="formState" class="hidden">
            <div class="security-badge">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                </svg>
                Connexion chiffrée de bout en bout
            </div>

            <div class="info-banner">
                <h3>Vos données sont protégées</h3>
                <p>Les informations que vous saisissez sont chiffrées directement dans votre navigateur.
                Seul votre notaire peut les déchiffrer.</p>
            </div>

            <div id="dossierInfo" class="dossier-info hidden">
                <strong>Dossier :</strong> <span id="dossierLabel"></span>
            </div>

            <form id="acheteurForm">
                <!-- Identité -->
                <section class="form-section">
                    <h2>Identité de l'acheteur</h2>

                    <div class="form-group">
                        <label for="civilite">Civilité *</label>
                        <select id="civilite" name="civilite" required>
                            <option value="">Sélectionner</option>
                            <option value="M">Monsieur</option>
                            <option value="Mme">Madame</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="nom">Nom de naissance *</label>
                        <input type="text" id="nom" name="nom" required placeholder="DUPONT" autocomplete="family-name">
                    </div>

                    <div class="form-group">
                        <label for="nom_usage">Nom d'usage</label>
                        <input type="text" id="nom_usage" name="nom_usage" placeholder="Si différent du nom de naissance">
                    </div>

                    <div class="form-group">
                        <label for="prenoms">Prénoms (dans l'ordre de l'acte de naissance) *</label>
                        <input type="text" id="prenoms" name="prenoms" required placeholder="Jean, Pierre, Marie" autocomplete="given-name">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="date_naissance">Date de naissance *</label>
                            <input type="date" id="date_naissance" name="date_naissance" required autocomplete="bday">
                        </div>
                        <div class="form-group">
                            <label for="lieu_naissance">Lieu de naissance *</label>
                            <input type="text" id="lieu_naissance" name="lieu_naissance" required placeholder="Paris (75)">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="nationalite">Nationalité *</label>
                        <input type="text" id="nationalite" name="nationalite" required value="Française">
                    </div>

                    <div class="form-group">
                        <label for="profession">Profession</label>
                        <input type="text" id="profession" name="profession" placeholder="Ingénieur, Retraité, etc.">
                    </div>
                </section>

                <!-- Adresse -->
                <section class="form-section">
                    <h2>Adresse actuelle</h2>

                    <div class="form-group">
                        <label for="adresse">Adresse complète *</label>
                        <input type="text" id="adresse" name="adresse" required placeholder="12 rue de la République" autocomplete="street-address">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="code_postal">Code postal *</label>
                            <input type="text" id="code_postal" name="code_postal" required placeholder="75001" autocomplete="postal-code">
                        </div>
                        <div class="form-group">
                            <label for="ville">Ville *</label>
                            <input type="text" id="ville" name="ville" required placeholder="Paris" autocomplete="address-level2">
                        </div>
                    </div>
                </section>

                <!-- Situation matrimoniale -->
                <section class="form-section">
                    <h2>Situation matrimoniale</h2>

                    <div class="form-group">
                        <label for="regime_matrimonial">Régime matrimonial *</label>
                        <select id="regime_matrimonial" name="regime_matrimonial" required>
                            <option value="">Sélectionner</option>
                            <option value="celibataire">Célibataire</option>
                            <option value="marie">Marié(e)</option>
                            <option value="pacs">Pacsé(e)</option>
                            <option value="divorce">Divorcé(e)</option>
                            <option value="veuf">Veuf(ve)</option>
                            <option value="separe">Séparé(e) de corps</option>
                        </select>
                    </div>

                    <div id="conjoint_section" class="hidden">
                        <h3>Informations du conjoint / partenaire</h3>

                        <div class="form-group">
                            <label for="conjoint_nom">Nom *</label>
                            <input type="text" id="conjoint_nom" name="conjoint_nom" placeholder="MARTIN">
                        </div>

                        <div class="form-group">
                            <label for="conjoint_prenoms">Prénoms *</label>
                            <input type="text" id="conjoint_prenoms" name="conjoint_prenoms" placeholder="Sophie, Marie">
                        </div>

                        <div class="form-group">
                            <label for="date_mariage">Date de mariage / PACS *</label>
                            <input type="date" id="date_mariage" name="date_mariage">
                        </div>

                        <div class="form-group">
                            <label for="lieu_mariage">Lieu de mariage / PACS *</label>
                            <input type="text" id="lieu_mariage" name="lieu_mariage" placeholder="Lyon (69)">
                        </div>

                        <div class="form-group">
                            <label for="type_regime">Type de régime *</label>
                            <select id="type_regime" name="type_regime">
                                <option value="">Sélectionner</option>
                                <option value="communaute_legale">Communauté légale (défaut)</option>
                                <option value="communaute_universelle">Communauté universelle</option>
                                <option value="separation_biens">Séparation de biens</option>
                                <option value="participation_acquets">Participation aux acquêts</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="conjoint_intervient" name="conjoint_intervient">
                                Le conjoint/partenaire intervient à l'acte
                            </label>
                        </div>
                    </div>
                </section>

                <!-- Pièces justificatives -->
                <section class="form-section">
                    <h2>Pièces d'identité</h2>

                    <div class="form-group">
                        <label for="cni_numero">Numéro de carte d'identité *</label>
                        <input type="text" id="cni_numero" name="cni_numero" required placeholder="123456789012">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cni_date_emission">Date d'émission *</label>
                            <input type="date" id="cni_date_emission" name="cni_date_emission" required>
                        </div>
                        <div class="form-group">
                            <label for="cni_date_expiration">Date d'expiration *</label>
                            <input type="date" id="cni_date_expiration" name="cni_date_expiration" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cni_autorite">Autorité émettrice *</label>
                        <input type="text" id="cni_autorite" name="cni_autorite" required placeholder="Préfecture de Paris">
                    </div>
                </section>

                <!-- Coordonnées bancaires -->
                <section class="form-section">
                    <h2>Coordonnées bancaires</h2>
                    <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 16px;">
                        Ces informations seront utilisées pour les éventuels remboursements.
                    </p>

                    <div class="form-group">
                        <label for="iban">IBAN *</label>
                        <input type="text" id="iban" name="iban" required placeholder="FR76 1234 5678 9012 3456 7890 123">
                    </div>

                    <div class="form-group">
                        <label for="bic">BIC *</label>
                        <input type="text" id="bic" name="bic" required placeholder="BNPAFRPPXXX">
                    </div>

                    <div class="form-group">
                        <label for="banque">Nom de la banque *</label>
                        <input type="text" id="banque" name="banque" required placeholder="BNP Paribas">
                    </div>
                </section>

                <!-- Contact -->
                <section class="form-section">
                    <h2>Coordonnées de contact</h2>

                    <div class="form-group">
                        <label for="telephone">Téléphone *</label>
                        <input type="tel" id="telephone" name="telephone" required placeholder="06 12 34 56 78" autocomplete="tel">
                    </div>

                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" name="email" required placeholder="jean.dupont@email.com" autocomplete="email">
                    </div>
                </section>

                <!-- RGPD -->
                <section class="form-section">
                    <h2>Consentement</h2>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="rgpd_consent" name="rgpd_consent" required>
                            J'accepte que mes données personnelles soient traitées par l'étude notariale
                            dans le cadre de mon dossier immobilier, conformément au RGPD. *
                        </label>
                    </div>
                </section>

                <!-- Buttons -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        Envoyer mes informations de manière sécurisée
                    </button>
                </div>
            </form>
        </div>

        <!-- État: Succès -->
        <div id="successState" class="success-state hidden">
            <div class="checkmark">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                </svg>
            </div>
            <h2>Formulaire envoyé avec succès !</h2>
            <p>Vos informations ont été transmises de manière sécurisée à votre notaire.</p>
            <p style="color: #6b7280; margin-top: 16px;">Vous pouvez fermer cette page.</p>
        </div>
    </div>

    <script src="crypto.js"></script>
    <script src="supabase-client.js"></script>
    <script src="fill-script.js"></script>
</body>
</html>
